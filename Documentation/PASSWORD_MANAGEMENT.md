# OpenEMR Password Management Documentation

## Password Change Interface Issues and Clarifications

### Overview
In OpenEMR's user administration interface, there are two password fields that can cause confusion:
1. **"Your Password"** - This is the administrator's current password (for authentication)
2. **"User's New Password"** - This is the new password being set for the target user

### Key Issue: Field Labeling Confusion

#### Problem Description
The password change form in OpenEMR's user administration can be confusing because:

1. **"Your Password"** field appears to be asking for confirmation of the new user's password
2. The actual new user password field is labeled **"User's New Password"**
3. Users may mistake "Your Password" as a password confirmation field

#### Current Implementation Details

**File: `/interface/usergroup/user_admin.php`**
- Line ~305: `<span class=text>*<?php echo xlt('Your Password'); ?>*: </span>` 
  - This field (`adminPass`) is for the ADMINISTRATOR'S current password
- Line ~312: `<span class=text><?php echo xlt('User\'s New Password'); ?>: </span>`
  - This field (`clearPass`) is for the USER'S new password

**File: `/interface/usergroup/usergroup_admin_add.php`**
- Line ~264: `<span class='text'><?php echo xlt('Your Password'); ?>: </span>`
  - This field (`adminPass`) is for the ADMINISTRATOR'S password when adding new users

### Authentication Flow

The password change process works as follows:

1. **Administrator Authentication**: The "Your Password" field authenticates the administrator making the change
2. **New Password Setting**: The "User's New Password" field sets the new password for the target user
3. **Backend Processing**: The `AuthUtils::updatePassword()` method processes both passwords:
   - `adminPass` → Administrator's current password (for authentication)
   - `clearPass` → New password for the target user

### Code References

**Authentication Logic in `src/Common/Auth/AuthUtils.php`:**

```php
// Line ~230 in usergroup_admin.php
if ($_POST["adminPass"] && $_POST["clearPass"]) {
    $authUtilsUpdatePassword = new AuthUtils();
    $success = $authUtilsUpdatePassword->updatePassword(
        $_SESSION['authUserID'],  // Current admin user ID
        $_POST['id'],            // Target user ID
        $_POST['adminPass'],     // Admin's current password
        $_POST['clearPass']      // New password for target user
    );
}
```

### Database Configuration (sqlconf.php)

**Location**: `/sites/default/sqlconf.php`

This file contains MySQL database credentials:
```php
$host   = 'localhost';
$port   = '3306';
$login  = 'openemr';        // MySQL username
$pass   = 'openemr';        // MySQL password
$dbase  = 'openemr';        // Database name
```

**Important**: This is separate from OpenEMR user passwords and should only be modified by system administrators who understand the database configuration.

### Best Practices and Recommendations

#### For Administrators:
1. **Always enter YOUR current OpenEMR password** in the "Your Password" field
2. **Enter the new password for the target user** in the "User's New Password" field
3. **Do NOT** use "Your Password" as a password confirmation field
4. **Leave "User's New Password" blank** if you don't want to change the user's password

#### For Developers:
1. Consider renaming labels for better clarity:
   - "Your Password" → "Administrator Password" or "Current Admin Password"
   - "User's New Password" → "New Password for [Username]"
2. Add help text or tooltips explaining each field's purpose
3. Consider adding visual separation between authentication and password setting sections

### Security Notes

1. **Password Strength**: OpenEMR enforces password strength requirements when `$GLOBALS['secure_password']` is enabled
2. **Password History**: The system can prevent reuse of previous passwords based on `$GLOBALS['password_history']` setting
3. **Failed Login Protection**: Multiple failed attempts can lock accounts based on configuration
4. **Audit Logging**: All password changes are logged for security auditing

### Help Text Currently Shown

The interface displays this helpful message:
> "*You must enter your own password to change user passwords. Leave blank to keep password unchanged.*"

However, this text appears at the bottom of the form and may be overlooked by users.

---

## Generated by GitHub Copilot
*This documentation was generated by GitHub Copilot to clarify the password management interface in OpenEMR and prevent common user errors.*